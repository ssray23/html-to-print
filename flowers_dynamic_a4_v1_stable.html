<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flowers in Perfumery - Dynamic A4 Pagination</title>
    <style>
        /* Print styles */
        @page {
            size: A4;
            margin: 0;
        }

        @media print {
            body {
                margin: 0;
                padding: 0;
                background: white;
            }
            .page {
                page-break-after: always;
                margin: 0;
                box-shadow: none;
                border: none;
            }
            .page:last-child {
                page-break-after: auto;
            }
            .source-content {
                display: none !important;
            }
            .controls {
                display: none !important;
            }
            thead {
                display: table-header-group;
            }
            tfoot {
                display: table-footer-group;
            }
        }

        /* General styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Helvetica, Arial, sans-serif;
            background: #e8e8e8;
            padding: 20px 0;
            line-height: 1.4;
        }

        /* Page container for screen view */
        .page {
            width: 210mm;
            height: 297mm;
            background: white;
            margin: 0 auto 20px auto;
            padding: 0.6cm;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid #ccc;
            position: relative;
            overflow: hidden;
        }

        /* Typography */
        h1 {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 24px;
            font-weight: bold;
            color: #000;
            text-align: center;
            border-bottom: 3px solid #000;
            padding-bottom: 8px;
            margin-bottom: 16px;
            page-break-inside: avoid;
            break-inside: avoid-page;
        }

        h2 {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 18px;
            font-weight: bold;
            color: #000;
            margin: 16px 0 8px 0;
            page-break-inside: avoid;
            break-inside: avoid-page;
        }

        p {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 13px;
            text-align: left;
            margin-bottom: 8px;
            page-break-inside: avoid;
            break-inside: avoid-page;
        }

        /* Table styles */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid #000;
            border-radius: 8px;
            overflow: hidden;
            margin: 8px 0;
            page-break-inside: avoid;
            break-inside: avoid-page;
        }

        thead {
            display: table-header-group;
        }

        tbody {
            display: table-row-group;
        }

        tfoot {
            display: table-footer-group;
        }

        th {
            background-color: #1a1a1a;
            color: white;
            font-family: Helvetica, Arial, sans-serif;
            font-weight: bold;
            padding: 8px 10px;
            text-align: left;
            border: 1px solid #000;
            font-size: 14px;
        }

        td {
            padding: 6px 8px;
            border: 1px solid #000;
            vertical-align: top;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 12px;
            line-height: 1.3;
        }

        tbody tr:nth-child(even) {
            background-color: #f8f8f8;
        }

        tbody tr:nth-child(odd) {
            background-color: white;
        }

        .flower-name {
            font-weight: bold;
            color: #1a1a1a;
        }

        .location {
            font-style: italic;
            color: #333;
        }

        .description {
            text-align: justify;
        }

        /* Callout boxes */
        .callout {
            border: 2px solid #1a1a1a;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            background: #f9f9f9;
            page-break-inside: avoid;
            break-inside: avoid-page;
        }

        /* Images */
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 8px auto;
        }

        /* Page content area */
        .page-content {
            overflow: hidden;
        }

        /* Source content (shown initially as single page) */
        .source-content {
            display: block;
            width: 210mm;
            margin: 0 auto;
            background: white;
            padding: 0.6cm;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        /* Paginated content container */
        .paginated-content {
            display: none;
        }

        .paginated-content.active {
            display: block;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .controls button {
            padding: 8px 16px;
            margin: 0 4px;
            border: 1px solid #333;
            background: #f7f7f7;
            cursor: pointer;
            border-radius: 4px;
            font-family: Helvetica, Arial, sans-serif;
        }

        .controls button:hover {
            background: #e7e7e7;
        }

        /* Measurement table (hidden, used for row height calculation) */
        .measurement-table {
            position: absolute;
            top: -9999px;
            left: -9999px;
            visibility: hidden;
            width: 210mm;
            padding: 0.6cm;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="console.log('Paginate button clicked'); dynamicPaginate()">Dynamic A4 Pagination</button>
        <button onclick="console.log('Source button clicked'); showSource()">Show Source</button>
        <button onclick="console.log('Print button clicked'); window.print()">Print</button>
        <span id="debug-info" style="margin-left: 20px; font-size: 12px; color: #666;">Ready - Showing continuous source document</span>
    </div>

    <!-- Hidden measurement container -->
    <div class="measurement-table">
        <table id="measurement-table">
            <thead>
                <tr>
                    <th style="width: 18%;">Flower</th>
                    <th style="width: 22%;">Origin &amp; Location</th>
                    <th style="width: 60%;">Fragrance Profile &amp; Perfumery Applications</th>
                </tr>
            </thead>
            <tbody id="measurement-tbody">
            </tbody>
        </table>
    </div>

    <!-- Source content -->
    <div class="source-content" id="source">
        <main role="main" aria-label="Flowers in Perfumery Guide">
            <h1>Flowers in Perfumery - A Comprehensive Reference Guide</h1>
            
            <section aria-label="Flower reference table">
                <table role="table">
                    <thead>
                        <tr>
                            <th style="width: 18%;">Flower</th>
                            <th style="width: 22%;">Origin &amp; Location</th>
                            <th style="width: 60%;">Fragrance Profile &amp; Perfumery Applications</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="flower-name">Rose (Rosa damascena)</td>
                            <td class="location">Bulgaria, Turkey, France (Grasse), Morocco</td>
                            <td class="description">Rose offers the most iconic and beloved fragrance in perfumery, with its rich, velvety, and intoxicating aroma that combines sweetness with depth. The scent varies from fresh and dewy in the morning to intensely passionate and warm, with subtle spicy and honey-like undertones. In perfume making, rose serves as both a heart note and a base note, providing extraordinary longevity and complexity. Bulgarian rose otto is considered the finest, requiring 4,000 kilograms of petals to produce just one kilogram of essential oil.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Jasmine (Jasminum grandiflorum)</td>
                            <td class="location">India, Egypt, Morocco, Southern France</td>
                            <td class="description">Jasmine possesses an intoxicating, narcotic fragrance that is simultaneously fresh, sweet, and animalic, creating one of the most complex and seductive scents in nature. The aroma is intensely floral with green, fruity facets and a rich, creamy undertone that becomes more pronounced at night. The flower's scent is so potent that it must be harvested before dawn to capture its peak intensity. In perfumery, jasmine is considered the "king of flowers" and serves as a precious heart note, adding depth, sensuality, and sophistication to compositions.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Lavender (Lavandula angustifolia)</td>
                            <td class="location">Provence (France), England, Bulgaria, Tasmania</td>
                            <td class="description">Lavender presents a clean, herbaceous, and profoundly calming fragrance with distinct camphorous and slightly sweet floral notes, complemented by fresh, green, and sometimes woody undertones. The scent is universally recognized for its soothing properties, evoking images of purple fields under the Mediterranean sun. French lavender from Provence is considered superior, offering the most refined and balanced aroma profile. In perfume making, lavender serves as a versatile top and middle note, providing freshness and aromatic structure to compositions.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Ylang-ylang (Cananga odorata)</td>
                            <td class="location">Madagascar, Philippines, Comoro Islands, Indonesia</td>
                            <td class="description">Ylang-ylang delivers an exotic, tropical fragrance that is intensely sweet, creamy, and narcotic, with distinctive banana-like and custard notes that create an almost edible quality. The scent has multiple facets, ranging from fresh and green in the top notes to rich, balsamic, and slightly spicy in the base, with jasmine-like floral undertones throughout. The flower's name means "flower of flowers" in Tagalog, reflecting its supreme fragrant status. In perfumery, ylang-ylang is distilled in fractions, each offering different aromatic profiles and intensities.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Neroli (Orange Blossom)</td>
                            <td class="location">Tunisia, Morocco, Southern France, Italy</td>
                            <td class="description">Neroli offers a sophisticated, fresh, and ethereally beautiful fragrance that perfectly balances citrusy brightness with soft floral elegance, creating a scent that is both uplifting and deeply romantic. The aroma has green, slightly bitter top notes that quickly develop into sweet, honeyed, and creamy floral heart notes, with subtle spicy and woody undertones. Named after the 17th-century Princess of Nerola, this flower represents luxury and refinement in perfumery. The scent is extracted through steam distillation of bitter orange blossoms.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Tuberose (Polianthes tuberosa)</td>
                            <td class="location">India, Mexico, Egypt, Morocco</td>
                            <td class="description">Tuberose possesses one of the most intoxicating and complex fragrances in the floral kingdom, with an intensely sweet, heady, and almost narcotic aroma that becomes more powerful at night. The scent combines creamy, vanilla-like sweetness with green, slightly mentholated top notes and deep, animalic, honey-like base notes that can be almost overwhelming in concentration. The flower releases its strongest fragrance after sunset, making it perfect for romantic evening compositions. In perfumery, tuberose is considered extremely precious and is used sparingly due to its intensity.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Gardenia (Gardenia jasminoides)</td>
                            <td class="location">China, Japan, Southern United States, India</td>
                            <td class="description">Gardenia presents a rich, creamy, and intensely romantic fragrance with velvety floral notes that combine the best qualities of jasmine and rose, creating a scent that is both sophisticated and intoxicating. The aroma is characterized by its smooth, waxy quality with subtle green undertones and a sweet, almost edible creaminess that intensifies in warm weather. The flower's scent is most pronounced in the evening hours, releasing waves of fragrance that can perfume entire gardens. In perfumery, gardenia is highly prized but technically challenging to extract.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Lily of the Valley</td>
                            <td class="location">Europe, Asia, Eastern North America</td>
                            <td class="description">Lily of the valley offers a fresh, green, and delicately sweet fragrance that captures the essence of spring awakening, with its clean, transparent, and almost crystalline scent quality. The aroma is characterized by its green, dewy freshness combined with soft floral notes and a subtle aldehydic sparkle that creates an airy, ethereal quality. The scent evokes morning dew on fresh leaves and the pure, innocent beauty of woodland flowers. In perfumery, lily of the valley cannot be extracted naturally and must be recreated using synthetic molecules.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Iris (Iris pallida)</td>
                            <td class="location">Florence (Italy), Morocco, France</td>
                            <td class="description">Iris presents a unique, sophisticated fragrance that is simultaneously powdery, rooty, and elegantly floral, with distinctive violet-like notes and a creamy, almost buttery undertone that develops over time. The scent has an unusual earthiness combined with refined floral elegance, creating an aroma that is both mysterious and comforting. Florentine iris is considered the finest, with its rhizomes requiring three years of drying before extraction to develop the characteristic orris scent. The fragrance has metallic, slightly green top notes that evolve into soft, powdery heart notes.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Violet (Viola odorata)</td>
                            <td class="location">France, Turkey, Egypt, Bulgaria</td>
                            <td class="description">Violet offers a sweet, powdery, and nostalgically romantic fragrance with distinctive green, slightly metallic top notes and soft, candy-like floral heart notes that evoke memories of childhood and Victorian elegance. The scent has an unusual characteristic of causing temporary anosmia, where the nose becomes temporarily unable to detect the fragrance after prolonged exposure. The aroma combines fresh, dewy green notes with sweet, almost edible floral notes and subtle earthy undertones. In perfumery, violet leaves and flowers are both used, with leaves providing green, cucumber-like freshness.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Magnolia (Magnolia grandiflora)</td>
                            <td class="location">Southern United States, China, Japan</td>
                            <td class="description">Magnolia presents a fresh, lemony, and elegantly floral fragrance with crisp, clean notes that combine citrusy brightness with soft, creamy floral undertones and subtle green, slightly spicy nuances. The scent is characterized by its clarity and transparency, offering a modern interpretation of floral fragrance that is both sophisticated and approachable. Southern magnolia has a more intense, richer fragrance compared to Asian varieties, with pronounced citrusy and slightly camphoraceous notes. The flower's aroma is most prominent during warm, humid conditions.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Frangipani (Plumeria)</td>
                            <td class="location">Tropical Asia, Pacific Islands, Central America</td>
                            <td class="description">Frangipani delivers an exotic, tropical fragrance that is intensely sweet, creamy, and reminiscent of tropical paradise, with rich floral notes combined with hints of coconut, vanilla, and ripe tropical fruits. The scent is most powerful during evening hours, releasing intoxicating waves of fragrance that can perfume entire areas with its heady, narcotic aroma. The flower's fragrance varies by color, with white and yellow varieties typically offering the strongest and most complex scent profiles. The aroma has fresh, green top notes that quickly develop into rich, creamy heart notes.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Mimosa (Acacia dealbata)</td>
                            <td class="location">Southern France, Australia, Africa</td>
                            <td class="description">Mimosa presents a warm, powdery, and honey-like fragrance with distinctive fluffy, soft notes that combine sweet floral elements with green, slightly bitter undertones and warm, woody base notes. The scent has a unique texture that feels almost tactile, evoking the sensation of touching the flower's soft, fuzzy yellow blooms. French mimosa from Grasse is considered superior, offering the most refined and balanced aroma profile with prominent honey and almond-like facets. The fragrance has fresh, green top notes that develop into warm, powdery, and sweet heart notes.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Peony (Paeonia lactiflora)</td>
                            <td class="location">China, Europe, North America</td>
                            <td class="description">Peony offers a fresh, rosy, and delicately sweet fragrance with soft, romantic notes that combine the elegance of rose with crisp, green, and slightly spicy undertones, creating a scent that is both sophisticated and naturally beautiful. The aroma has a clean, transparent quality with subtle fruity facets and a fresh, dewy character that captures the essence of spring gardens in full bloom. Chinese peonies typically have the most intense fragrance, particularly the deep pink and red varieties, while white peonies offer more subtle, green-tinged aromas.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Carnation (Dianthus caryophyllus)</td>
                            <td class="location">Mediterranean region, Europe, Colombia</td>
                            <td class="description">Carnation presents a spicy, clove-like fragrance with warm, peppery notes that distinguish it from typical floral scents, combining sweet floral elements with distinctive spicy, almost culinary undertones and subtle animalic facets. The scent is characterized by its cinnamon and nutmeg-like qualities, with bright, slightly sharp top notes and warm, honeyed heart notes. The fragrance intensity varies by color, with deep red carnations typically offering the strongest and most complex spicy-floral profiles. Colombian carnations are particularly prized for their intense fragrance.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Freesia (Freesia refracta)</td>
                            <td class="location">South Africa, Netherlands, California</td>
                            <td class="description">Freesia offers a fresh, crisp, and delicately sweet fragrance with bright, peppery top notes and soft, soapy, almost powdery heart notes that create a clean, modern, and sophisticated scent profile. The aroma has a unique transparency and lightness that makes it both refreshing and elegant, with subtle green undertones and a slightly metallic, ozonic quality that evokes spring rain and clean air. White and yellow freesias typically have the strongest fragrance, while colored varieties offer more subtle aromatic profiles. The scent has sharp, almost lemony top notes.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Honeysuckle (Lonicera periclymenum)</td>
                            <td class="location">Europe, Asia, North America</td>
                            <td class="description">Honeysuckle presents a sweet, nectar-like fragrance with intense honey and vanilla notes that create an almost edible quality, combined with fresh, green undertones and subtle fruity facets that evoke summer evenings and childhood memories. The scent is most powerful during twilight hours, releasing intoxicating waves of sweet fragrance that can perfume entire gardens with its romantic, nostalgic aroma. The fragrance has bright, green top notes that quickly develop into rich, sweet, honey-like heart notes with warm, slightly balsamic base notes.</td>
                        </tr>
                        <tr>
                            <td class="flower-name">Osmanthus (Osmanthus fragrans)</td>
                            <td class="location">China, Japan, Taiwan</td>
                            <td class="description">Osmanthus offers a unique, apricot-like fragrance with fruity, peachy notes that combine sweet floral elements with distinctive leather-like undertones and subtle animalic facets, creating one of the most unusual and sophisticated scents in perfumery. The aroma has a rich, velvety quality with prominent apricot and peach notes, complemented by warm, honeyed heart notes and complex, slightly smoky base notes that develop over time. Chinese osmanthus is particularly prized, especially varieties that bloom in autumn, offering the most intense and complex fragrance profiles.</td>
                        </tr>
                    </tbody>
                </table>
            </section>
        </main>
    </div>

    <!-- Paginated content container -->
    <div class="paginated-content" id="paginated">
        <!-- Pages will be generated here by JavaScript -->
    </div>

    <script>
        let sourceContent = null;
        let paginatedContainer = null;
        let rowHeights = [];
        let debugInfo = null;

        function init() {
            console.log('Initializing...');
            sourceContent = document.getElementById('source');
            paginatedContainer = document.getElementById('paginated');
            debugInfo = document.getElementById('debug-info');
            
            console.log('Source content:', sourceContent);
            console.log('Paginated container:', paginatedContainer);
            console.log('Debug info:', debugInfo);
            
            if (!sourceContent || !paginatedContainer || !debugInfo) {
                console.error('Failed to initialize - missing elements');
                return;
            }
            
            console.log('Initialization complete');
        }

        function showSource() {
            console.log('Showing source content');
            sourceContent.style.display = 'block';
            paginatedContainer.classList.remove('active');
            paginatedContainer.style.display = 'none';
            debugInfo.textContent = 'Showing continuous source document';
        }

        // Calculate individual row heights by building a full-height reference table
        function calculateRowHeights() {
            console.log('Calculating row heights...');
            
            const sourceTable = sourceContent.querySelector('table tbody');
            const measurementTable = document.getElementById('measurement-table');
            const measurementTbody = document.getElementById('measurement-tbody');
            
            if (!sourceTable || !measurementTable || !measurementTbody) {
                console.error('Missing elements for row height calculation');
                return [];
            }
            
            // Clear measurement table
            measurementTbody.innerHTML = '';
            
            // Clone all rows to measurement table
            const allRows = Array.from(sourceTable.querySelectorAll('tr'));
            console.log(`Found ${allRows.length} rows to measure`);
            
            allRows.forEach(row => {
                measurementTbody.appendChild(row.cloneNode(true));
            });
            
            // Force layout and measure each row individually
            measurementTable.offsetHeight; // Force layout
            const measurementRows = Array.from(measurementTbody.querySelectorAll('tr'));
            
            rowHeights = measurementRows.map((row, index) => {
                const height = row.offsetHeight;
                console.log(`Row ${index + 1}: ${height}px`);
                return height;
            });
            
            console.log('Total rows measured:', rowHeights.length);
            console.log('Row heights:', rowHeights);
            
            return rowHeights;
        }

        // Create a new page with header
        function createNewPage(pageNumber) {
            const page = document.createElement('div');
            page.className = 'page';
            
            const content = document.createElement('div');
            content.className = 'page-content';
            
            // Add title only to first page
            if (pageNumber === 1) {
                const header = document.createElement('main');
                header.setAttribute('role', 'main');
                header.setAttribute('aria-label', 'Flowers in Perfumery Guide');
                
                const h1 = document.createElement('h1');
                h1.textContent = 'Flowers in Perfumery - A Comprehensive Reference Guide';
                header.appendChild(h1);
                
                content.appendChild(header);
            }
            
            // Create table with header
            const section = document.createElement('section');
            section.setAttribute('aria-label', 'Flower reference table' + (pageNumber > 1 ? ' continued' : ''));
            
            const table = document.createElement('table');
            table.setAttribute('role', 'table');
            
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th style="width: 18%;">Flower</th>
                    <th style="width: 22%;">Origin & Location</th>
                    <th style="width: 60%;">Fragrance Profile & Perfumery Applications</th>
                </tr>
            `;
            
            const tbody = document.createElement('tbody');
            
            table.appendChild(thead);
            table.appendChild(tbody);
            section.appendChild(table);
            content.appendChild(section);
            page.appendChild(content);
            
            paginatedContainer.appendChild(page);
            
            return { page, content, table, tbody };
        }

        // Measure remaining space in page after adding current content
        function getRemainingSpace(page) {
            // A4 is 297mm height. At 96 DPI: 297mm = 1123px approximately
            const pageHeightPx = 1123;
            // 0.6cm = 22.68px at 96 DPI
            const paddingPx = 23 * 2; // top + bottom padding
            const availableHeight = pageHeightPx - paddingPx;
            
            // Force layout
            page.offsetHeight;
            
            const content = page.querySelector('.page-content');
            const currentHeight = content.scrollHeight;
            
            // Debug what's taking up the space
            const header = content.querySelector('main');
            const section = content.querySelector('section');
            const table = content.querySelector('table');
            const thead = table ? table.querySelector('thead') : null;
            const tbody = table ? table.querySelector('tbody') : null;
            
            console.log('=== SPACE BREAKDOWN ===');
            console.log(`Total content height: ${currentHeight}px`);
            if (header) console.log(`Header height: ${header.offsetHeight}px`);
            if (section) console.log(`Section height: ${section.offsetHeight}px`);
            if (table) console.log(`Table height: ${table.offsetHeight}px`);
            if (thead) console.log(`Thead height: ${thead.offsetHeight}px`);
            if (tbody) console.log(`Tbody height: ${tbody.offsetHeight}px`);
            
            const remainingSpace = availableHeight - currentHeight;
            
            console.log(`Page height: ${pageHeightPx}px, Available: ${availableHeight}px, Current: ${currentHeight}px, Remaining: ${remainingSpace}px`);
            
            return remainingSpace;
        }

        // Dynamic pagination function
        function dynamicPaginate() {
            console.log('Starting dynamic pagination...');
            
            // Hide source and show paginated content
            sourceContent.style.display = 'none';
            paginatedContainer.style.display = 'block';
            paginatedContainer.classList.add('active');
            paginatedContainer.innerHTML = '';
            
            debugInfo.textContent = 'Calculating row heights and creating pages...';
            
            // Calculate row heights first
            const heights = calculateRowHeights();
            
            const sourceRows = Array.from(sourceContent.querySelector('table tbody').querySelectorAll('tr'));
            
            let currentRowIndex = 0;
            let pageNumber = 1;
            let { page, content, table, tbody } = createNewPage(pageNumber);
            
            let totalRowsPlaced = 0;
            let pagesCreated = 1;
            
            while (currentRowIndex < sourceRows.length) {
                const currentRow = sourceRows[currentRowIndex].cloneNode(true);
                const rowHeight = heights[currentRowIndex];
                
                // Measure remaining space BEFORE adding the row
                const remainingSpace = getRemainingSpace(page);
                
                console.log(`\nTrying to place row ${currentRowIndex + 1} (height: ${rowHeight}px) - Remaining space: ${remainingSpace}px`);
                
                // Check if row fits (add small buffer for safety)
                if (rowHeight <= remainingSpace - 10) {
                    // Row fits - add it to current page
                    tbody.appendChild(currentRow);
                    totalRowsPlaced++;
                    currentRowIndex++;
                    console.log(`✓ Row ${currentRowIndex} placed on page ${pageNumber}`);
                } else {
                    // Row doesn't fit - create new page
                    console.log(`✗ Row ${currentRowIndex + 1} doesn't fit, creating new page`);
                    
                    pageNumber++;
                    pagesCreated++;
                    const newPageData = createNewPage(pageNumber);
                    page = newPageData.page;
                    content = newPageData.content;
                    table = newPageData.table;
                    tbody = newPageData.tbody;
                    
                    // Don't increment currentRowIndex - try placing the same row on new page
                }
            }
            
            // Add callout to last page if there's space
            const finalRemainingSpace = getRemainingSpace(page);
            if (finalRemainingSpace > 150) { // Enough space for callout
                const callout = document.createElement('div');
                callout.className = 'callout';
                callout.innerHTML = `
                    <h2>About This Guide</h2>
                    <p>This comprehensive reference guide provides detailed information about the most important flowers used in perfumery. Each entry includes the botanical name, geographic origins, and detailed fragrance profiles that describe the complex aromatic characteristics that make these flowers valuable in the art of perfume making.</p>
                    <p>The fragrance descriptions focus on the olfactory experience, noting top, middle, and base notes, as well as the emotional and sensory associations that make each flower unique in the perfumer's palette.</p>
                `;
                content.appendChild(callout);
            }
            
            debugInfo.textContent = `✓ Dynamic pagination complete: ${totalRowsPlaced} rows across ${pagesCreated} pages`;
            
            console.log(`\nPagination complete: ${totalRowsPlaced} rows placed across ${pagesCreated} pages`);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>